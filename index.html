<!-- api key:  AIzaSyCKYLHdWZSYqmvUyybJYV1iB2FOaJsaOxY -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Street View side-by-side</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map, #pano {
        float: left;
        height: 80%;
        width: 45%;
      }
  	  #pano text {
  		display: none;
  	  }
      #menu{
        margin-left: 20px;

      }
    </style>
  </head>
  <body>
    <div id="menu">
    <p id="skoor">Liigutusi</p>
    <button onClick="getPanorama()" >UUS ASUKOHT</button>
  </div>
    <div id="map" style="height:300px"></div>
    <div id="pano"></div>

    <script>
	  var left =  59.453145;
		var top_c = 24.692039;
		var right = 59.427036;
		var bottom = 24.823728;
	  var tartu;
    var score = 0;

	  var pano;

      function initialize() {

		//console.log(tartu);

    //Add listener




        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 58.9278205, lng: 25.6992991},
          zoom: 6,
		  styles: [ { "elementType": "labels", "stylers": [ { "visibility": "off" } ] } ],
		  disableDefaultUI: true
        });

// v√µtab kliki peale mapi koordinaadid
        map.addListener("click", function (event) {
            var latitude = event.latLng.lat();
            var longitude = event.latLng.lng();
            console.log( latitude + ', ' + longitude );
        });


		getPanorama();


      }

	  function getPanorama(){
		//console.log(bottom - Math.random()*(bottom-top_c));
		tartu = {lat: left - Math.random()*(left-right), lng: bottom - Math.random()*(bottom-top_c)};
	    //console.log(tartu);

		var streetviewService = new google.maps.StreetViewService;

		streetviewService.getPanorama(

			{location: tartu, preference: google.maps.StreetViewPreference.NEAREST, radius: 500},

			function(data, status){
				if(!data){
					getPanorama();
				}



				console.log(data.location.latLng);
				if(pano){
					pano.setPosition(data.location.latLng);
					return;
				}
				loadPano(data.location.latLng);
			}
		);
	  }


		//1 kord ainult
	  function loadPano(coordinates){
		pano = new google.maps.StreetViewPanorama(
            document.getElementById('pano'), {
              position: coordinates,
              pov: {
                heading: 34,
                pitch: 10,
              },
			  linksControl: true,
			  disableDefaultUI: true,
			  panControl: false,
			  enableCloseButton: false
            });
        //setStreetView(panorama);


        pano.addListener('position_changed', function() {
          score = score + 1;
            document.getElementById("skoor").innerHTML ="Liigutusi: " +  score;
        });
	  }




    </script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKYLHdWZSYqmvUyybJYV1iB2FOaJsaOxY&callback=initialize">
    </script>
  </body>
</html>
